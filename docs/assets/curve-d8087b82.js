import{R as Yt,V as d,g as bt,Q as G,E as qt,h as Zt,b as Pt,L as Wt,i as Y,B as F,j as wt,F as yt,c as i,k as ct,l as U,m as Rt,n as et,o as Ut,p as Bt,q as Nt,r as Vt,s as xt,t as $t,S as Jt,P as Kt,W as te,A as ee,D as ne,a as oe,O as ie,M as Dt,e as se,C as ae,d as re,u as le}from"./OrbitControls-50fa714a.js";import{f as ce,G as he,D as de}from"./fit-curve-adba4c64.js";const N=new Yt,Z=new d,B=new d,P=new G,Mt={X:new d(1,0,0),Y:new d(0,1,0),Z:new d(0,0,1)},gt={type:"change"},_t={type:"mouseDown"},zt={type:"mouseUp",mode:null},It={type:"objectChange"};class pe extends bt{constructor(o,s){super(),s===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),s=document),this.isTransformControls=!0,this.visible=!1,this.domElement=s,this.domElement.style.touchAction="none";const t=new xe;this._gizmo=t,this.add(t);const n=new ge;this._plane=n,this.add(n);const l=this;function e(w,u){let x=u;Object.defineProperty(l,w,{get:function(){return x!==void 0?x:u},set:function(h){x!==h&&(x=h,n[w]=h,t[w]=h,l.dispatchEvent({type:w+"-changed",value:h}),l.dispatchEvent(gt))}}),l[w]=u,n[w]=u,t[w]=u}e("camera",o),e("object",void 0),e("enabled",!0),e("axis",null),e("mode","translate"),e("translationSnap",null),e("rotationSnap",null),e("scaleSnap",null),e("space","world"),e("size",1),e("dragging",!1),e("showX",!0),e("showY",!0),e("showZ",!0);const f=new d,A=new d,m=new G,r=new G,v=new d,E=new G,c=new d,I=new d,M=new d,b=0,_=new d;e("worldPosition",f),e("worldPositionStart",A),e("worldQuaternion",m),e("worldQuaternionStart",r),e("cameraPosition",v),e("cameraQuaternion",E),e("pointStart",c),e("pointEnd",I),e("rotationAxis",M),e("rotationAngle",b),e("eye",_),this._offset=new d,this._startNorm=new d,this._endNorm=new d,this._cameraScale=new d,this._parentPosition=new d,this._parentQuaternion=new G,this._parentQuaternionInv=new G,this._parentScale=new d,this._worldScaleStart=new d,this._worldQuaternionInv=new G,this._worldScale=new d,this._positionStart=new d,this._quaternionStart=new G,this._scaleStart=new d,this._getPointer=ue.bind(this),this._onPointerDown=me.bind(this),this._onPointerHover=fe.bind(this),this._onPointerMove=we.bind(this),this._onPointerUp=ye.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(o){if(this.object===void 0||this.dragging===!0)return;N.setFromCamera(o,this.camera);const s=St(this._gizmo.picker[this.mode],N);s?this.axis=s.object.name:this.axis=null}pointerDown(o){if(!(this.object===void 0||this.dragging===!0||o.button!==0)&&this.axis!==null){N.setFromCamera(o,this.camera);const s=St(this._plane,N,!0);s&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(s.point).sub(this.worldPositionStart)),this.dragging=!0,_t.mode=this.mode,this.dispatchEvent(_t)}}pointerMove(o){const s=this.axis,t=this.mode,n=this.object;let l=this.space;if(t==="scale"?l="local":(s==="E"||s==="XYZE"||s==="XYZ")&&(l="world"),n===void 0||s===null||this.dragging===!1||o.button!==-1)return;N.setFromCamera(o,this.camera);const e=St(this._plane,N,!0);if(e){if(this.pointEnd.copy(e.point).sub(this.worldPositionStart),t==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),l==="local"&&s!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),s.indexOf("X")===-1&&(this._offset.x=0),s.indexOf("Y")===-1&&(this._offset.y=0),s.indexOf("Z")===-1&&(this._offset.z=0),l==="local"&&s!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(l==="local"&&(n.position.applyQuaternion(P.copy(this._quaternionStart).invert()),s.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),s.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),s.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),l==="world"&&(n.parent&&n.position.add(Z.setFromMatrixPosition(n.parent.matrixWorld)),s.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),s.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),s.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(Z.setFromMatrixPosition(n.parent.matrixWorld))));else if(t==="scale"){if(s.search("XYZ")!==-1){let f=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(f*=-1),B.set(f,f,f)}else Z.copy(this.pointStart),B.copy(this.pointEnd),Z.applyQuaternion(this._worldQuaternionInv),B.applyQuaternion(this._worldQuaternionInv),B.divide(Z),s.search("X")===-1&&(B.x=1),s.search("Y")===-1&&(B.y=1),s.search("Z")===-1&&(B.z=1);n.scale.copy(this._scaleStart).multiply(B),this.scaleSnap&&(s.search("X")!==-1&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),s.search("Y")!==-1&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),s.search("Z")!==-1&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(t==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const f=20/this.worldPosition.distanceTo(Z.setFromMatrixPosition(this.camera.matrixWorld));s==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):s==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Z.copy(this.rotationAxis).cross(this.eye))*f):(s==="X"||s==="Y"||s==="Z")&&(this.rotationAxis.copy(Mt[s]),Z.copy(Mt[s]),l==="local"&&Z.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(Z.cross(this.eye).normalize())*f),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),l==="local"&&s!=="E"&&s!=="XYZE"?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(P.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(P.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(gt),this.dispatchEvent(It)}}pointerUp(o){o.button===0&&(this.dragging&&this.axis!==null&&(zt.mode=this.mode,this.dispatchEvent(zt)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(o){o.geometry&&o.geometry.dispose(),o.material&&o.material.dispose()})}attach(o){return this.object=o,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(gt),this.dispatchEvent(It),this.pointStart.copy(this.pointEnd))}getRaycaster(){return N}getMode(){return this.mode}setMode(o){this.mode=o}setTranslationSnap(o){this.translationSnap=o}setRotationSnap(o){this.rotationSnap=o}setScaleSnap(o){this.scaleSnap=o}setSize(o){this.size=o}setSpace(o){this.space=o}}function ue(a){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:a.button};{const o=this.domElement.getBoundingClientRect();return{x:(a.clientX-o.left)/o.width*2-1,y:-(a.clientY-o.top)/o.height*2+1,button:a.button}}}function fe(a){if(this.enabled)switch(a.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(a));break}}function me(a){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(a.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(a)),this.pointerDown(this._getPointer(a)))}function we(a){this.enabled&&this.pointerMove(this._getPointer(a))}function ye(a){this.enabled&&(this.domElement.releasePointerCapture(a.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(a)))}function St(a,o,s){const t=o.intersectObject(a,!0);for(let n=0;n<t.length;n++)if(t[n].object.visible||s)return t[n];return!1}const ht=new qt,g=new d(0,1,0),Tt=new d(0,0,0),Ct=new Zt,dt=new G,mt=new G,k=new d,At=new Zt,it=new d(1,0,0),$=new d(0,1,0),st=new d(0,0,1),pt=new d,nt=new d,ot=new d;class xe extends bt{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const o=new Pt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=new Wt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=o.clone();t.opacity=.15;const n=s.clone();n.opacity=.5;const l=o.clone();l.color.setHex(16711680);const e=o.clone();e.color.setHex(65280);const f=o.clone();f.color.setHex(255);const A=o.clone();A.color.setHex(16711680),A.opacity=.5;const m=o.clone();m.color.setHex(65280),m.opacity=.5;const r=o.clone();r.color.setHex(255),r.opacity=.5;const v=o.clone();v.opacity=.25;const E=o.clone();E.color.setHex(16776960),E.opacity=.25,o.clone().color.setHex(16776960);const I=o.clone();I.color.setHex(7895160);const M=new Y(0,.04,.1,12);M.translate(0,.05,0);const b=new F(.08,.08,.08);b.translate(0,.04,0);const _=new wt;_.setAttribute("position",new yt([0,0,0,1,0,0],3));const w=new Y(.0075,.0075,.5,3);w.translate(0,.25,0);function u(z,W){const T=new et(z,.0075,3,64,W*Math.PI*2);return T.rotateY(Math.PI/2),T.rotateX(Math.PI/2),T}function x(){const z=new wt;return z.setAttribute("position",new yt([0,0,0,1,1,1],3)),z}const h={X:[[new i(M,l),[.5,0,0],[0,0,-Math.PI/2]],[new i(M,l),[-.5,0,0],[0,0,Math.PI/2]],[new i(w,l),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new i(M,e),[0,.5,0]],[new i(M,e),[0,-.5,0],[Math.PI,0,0]],[new i(w,e)]],Z:[[new i(M,f),[0,0,.5],[Math.PI/2,0,0]],[new i(M,f),[0,0,-.5],[-Math.PI/2,0,0]],[new i(w,f),null,[Math.PI/2,0,0]]],XYZ:[[new i(new ct(.1,0),v.clone()),[0,0,0]]],XY:[[new i(new F(.15,.15,.01),r.clone()),[.15,.15,0]]],YZ:[[new i(new F(.15,.15,.01),A.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new i(new F(.15,.15,.01),m.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},S={X:[[new i(new Y(.2,0,.6,4),t),[.3,0,0],[0,0,-Math.PI/2]],[new i(new Y(.2,0,.6,4),t),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new i(new Y(.2,0,.6,4),t),[0,.3,0]],[new i(new Y(.2,0,.6,4),t),[0,-.3,0],[0,0,Math.PI]]],Z:[[new i(new Y(.2,0,.6,4),t),[0,0,.3],[Math.PI/2,0,0]],[new i(new Y(.2,0,.6,4),t),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new i(new ct(.2,0),t)]],XY:[[new i(new F(.2,.2,.01),t),[.15,.15,0]]],YZ:[[new i(new F(.2,.2,.01),t),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new i(new F(.2,.2,.01),t),[.15,0,.15],[-Math.PI/2,0,0]]]},C={START:[[new i(new ct(.01,2),n),null,null,null,"helper"]],END:[[new i(new ct(.01,2),n),null,null,null,"helper"]],DELTA:[[new U(x(),n),null,null,null,"helper"]],X:[[new U(_,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new U(_,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new U(_,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},p={XYZE:[[new i(u(.5,1),I),null,[0,Math.PI/2,0]]],X:[[new i(u(.5,.5),l)]],Y:[[new i(u(.5,.5),e),null,[0,0,-Math.PI/2]]],Z:[[new i(u(.5,.5),f),null,[0,Math.PI/2,0]]],E:[[new i(u(.75,1),E),null,[0,Math.PI/2,0]]]},L={AXIS:[[new U(_,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},y={XYZE:[[new i(new Rt(.25,10,8),t)]],X:[[new i(new et(.5,.1,4,24),t),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new i(new et(.5,.1,4,24),t),[0,0,0],[Math.PI/2,0,0]]],Z:[[new i(new et(.5,.1,4,24),t),[0,0,0],[0,0,-Math.PI/2]]],E:[[new i(new et(.75,.1,2,24),t)]]},Q={X:[[new i(b,l),[.5,0,0],[0,0,-Math.PI/2]],[new i(w,l),[0,0,0],[0,0,-Math.PI/2]],[new i(b,l),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new i(b,e),[0,.5,0]],[new i(w,e)],[new i(b,e),[0,-.5,0],[0,0,Math.PI]]],Z:[[new i(b,f),[0,0,.5],[Math.PI/2,0,0]],[new i(w,f),[0,0,0],[Math.PI/2,0,0]],[new i(b,f),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new i(new F(.15,.15,.01),r),[.15,.15,0]]],YZ:[[new i(new F(.15,.15,.01),A),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new i(new F(.15,.15,.01),m),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new i(new F(.1,.1,.1),v.clone())]]},j={X:[[new i(new Y(.2,0,.6,4),t),[.3,0,0],[0,0,-Math.PI/2]],[new i(new Y(.2,0,.6,4),t),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new i(new Y(.2,0,.6,4),t),[0,.3,0]],[new i(new Y(.2,0,.6,4),t),[0,-.3,0],[0,0,Math.PI]]],Z:[[new i(new Y(.2,0,.6,4),t),[0,0,.3],[Math.PI/2,0,0]],[new i(new Y(.2,0,.6,4),t),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new i(new F(.2,.2,.01),t),[.15,.15,0]]],YZ:[[new i(new F(.2,.2,.01),t),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new i(new F(.2,.2,.01),t),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new i(new F(.2,.2,.2),t),[0,0,0]]]},K={X:[[new U(_,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new U(_,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new U(_,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function O(z){const W=new bt;for(const T in z)for(let tt=z[T].length;tt--;){const X=z[T][tt][0].clone(),at=z[T][tt][1],rt=z[T][tt][2],lt=z[T][tt][3],Gt=z[T][tt][4];X.name=T,X.tag=Gt,at&&X.position.set(at[0],at[1],at[2]),rt&&X.rotation.set(rt[0],rt[1],rt[2]),lt&&X.scale.set(lt[0],lt[1],lt[2]),X.updateMatrix();const Et=X.geometry.clone();Et.applyMatrix4(X.matrix),X.geometry=Et,X.renderOrder=1/0,X.position.set(0,0,0),X.rotation.set(0,0,0),X.scale.set(1,1,1),W.add(X)}return W}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=O(h)),this.add(this.gizmo.rotate=O(p)),this.add(this.gizmo.scale=O(Q)),this.add(this.picker.translate=O(S)),this.add(this.picker.rotate=O(y)),this.add(this.picker.scale=O(j)),this.add(this.helper.translate=O(C)),this.add(this.helper.rotate=O(L)),this.add(this.helper.scale=O(K)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(o){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:mt;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let l=0;l<n.length;l++){const e=n[l];e.visible=!0,e.rotation.set(0,0,0),e.position.copy(this.worldPosition);let f;if(this.camera.isOrthographicCamera?f=(this.camera.top-this.camera.bottom)/this.camera.zoom:f=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),e.scale.set(1,1,1).multiplyScalar(f*this.size/4),e.tag==="helper"){e.visible=!1,e.name==="AXIS"?(e.position.copy(this.worldPositionStart),e.visible=!!this.axis,this.axis==="X"&&(P.setFromEuler(ht.set(0,0,0)),e.quaternion.copy(t).multiply(P),Math.abs(g.copy(it).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),this.axis==="Y"&&(P.setFromEuler(ht.set(0,0,Math.PI/2)),e.quaternion.copy(t).multiply(P),Math.abs(g.copy($).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),this.axis==="Z"&&(P.setFromEuler(ht.set(0,Math.PI/2,0)),e.quaternion.copy(t).multiply(P),Math.abs(g.copy(st).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),this.axis==="XYZE"&&(P.setFromEuler(ht.set(0,Math.PI/2,0)),g.copy(this.rotationAxis),e.quaternion.setFromRotationMatrix(Ct.lookAt(Tt,g,$)),e.quaternion.multiply(P),e.visible=this.dragging),this.axis==="E"&&(e.visible=!1)):e.name==="START"?(e.position.copy(this.worldPositionStart),e.visible=this.dragging):e.name==="END"?(e.position.copy(this.worldPosition),e.visible=this.dragging):e.name==="DELTA"?(e.position.copy(this.worldPositionStart),e.quaternion.copy(this.worldQuaternionStart),Z.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Z.applyQuaternion(this.worldQuaternionStart.clone().invert()),e.scale.copy(Z),e.visible=this.dragging):(e.quaternion.copy(t),this.dragging?e.position.copy(this.worldPositionStart):e.position.copy(this.worldPosition),this.axis&&(e.visible=this.axis.search(e.name)!==-1));continue}e.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(e.name==="X"&&Math.abs(g.copy(it).applyQuaternion(t).dot(this.eye))>.99&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),e.name==="Y"&&Math.abs(g.copy($).applyQuaternion(t).dot(this.eye))>.99&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),e.name==="Z"&&Math.abs(g.copy(st).applyQuaternion(t).dot(this.eye))>.99&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),e.name==="XY"&&Math.abs(g.copy(st).applyQuaternion(t).dot(this.eye))<.2&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),e.name==="YZ"&&Math.abs(g.copy(it).applyQuaternion(t).dot(this.eye))<.2&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),e.name==="XZ"&&Math.abs(g.copy($).applyQuaternion(t).dot(this.eye))<.2&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1)):this.mode==="rotate"&&(dt.copy(t),g.copy(this.eye).applyQuaternion(P.copy(t).invert()),e.name.search("E")!==-1&&e.quaternion.setFromRotationMatrix(Ct.lookAt(this.eye,Tt,$)),e.name==="X"&&(P.setFromAxisAngle(it,Math.atan2(-g.y,g.z)),P.multiplyQuaternions(dt,P),e.quaternion.copy(P)),e.name==="Y"&&(P.setFromAxisAngle($,Math.atan2(g.x,g.z)),P.multiplyQuaternions(dt,P),e.quaternion.copy(P)),e.name==="Z"&&(P.setFromAxisAngle(st,Math.atan2(g.y,g.x)),P.multiplyQuaternions(dt,P),e.quaternion.copy(P))),e.visible=e.visible&&(e.name.indexOf("X")===-1||this.showX),e.visible=e.visible&&(e.name.indexOf("Y")===-1||this.showY),e.visible=e.visible&&(e.name.indexOf("Z")===-1||this.showZ),e.visible=e.visible&&(e.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),e.material._color=e.material._color||e.material.color.clone(),e.material._opacity=e.material._opacity||e.material.opacity,e.material.color.copy(e.material._color),e.material.opacity=e.material._opacity,this.enabled&&this.axis&&(e.name===this.axis||this.axis.split("").some(function(A){return e.name===A}))&&(e.material.color.setHex(16776960),e.material.opacity=1)}super.updateMatrixWorld(o)}}class ge extends i{constructor(){super(new Ut(1e5,1e5,2,2),new Pt({visible:!1,wireframe:!0,side:Bt,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(o){let s=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(s="local"),pt.copy(it).applyQuaternion(s==="local"?this.worldQuaternion:mt),nt.copy($).applyQuaternion(s==="local"?this.worldQuaternion:mt),ot.copy(st).applyQuaternion(s==="local"?this.worldQuaternion:mt),g.copy(nt),this.mode){case"translate":case"scale":switch(this.axis){case"X":g.copy(this.eye).cross(pt),k.copy(pt).cross(g);break;case"Y":g.copy(this.eye).cross(nt),k.copy(nt).cross(g);break;case"Z":g.copy(this.eye).cross(ot),k.copy(ot).cross(g);break;case"XY":k.copy(ot);break;case"YZ":k.copy(pt);break;case"XZ":g.copy(ot),k.copy(nt);break;case"XYZ":case"E":k.set(0,0,0);break}break;case"rotate":default:k.set(0,0,0)}k.length()===0?this.quaternion.copy(this.cameraQuaternion):(At.lookAt(Z.set(0,0,0),k,g),this.quaternion.setFromRotationMatrix(At)),super.updateMatrixWorld(o)}}class Se extends Nt{constructor(o){super(o)}load(o,s,t,n){const l=this,e=new Vt(this.manager);e.setPath(this.path),e.setResponseType("arraybuffer"),e.setRequestHeader(this.requestHeader),e.setWithCredentials(this.withCredentials),e.load(o,function(f){try{s(l.parse(f))}catch(A){n?n(A):console.error(A),l.manager.itemError(o)}},t,n)}parse(o){function s(m){const r=new DataView(m),v=32/8*3+32/8*3*3+16/8,E=r.getUint32(80,!0);if(80+32/8+E*v===r.byteLength)return!0;const I=[115,111,108,105,100];for(let M=0;M<5;M++)if(t(I,r,M))return!1;return!0}function t(m,r,v){for(let E=0,c=m.length;E<c;E++)if(m[E]!==r.getUint8(v+E))return!1;return!0}function n(m){const r=new DataView(m),v=r.getUint32(80,!0);let E,c,I,M=!1,b,_,w,u,x;for(let y=0;y<80-10;y++)r.getUint32(y,!1)==1129270351&&r.getUint8(y+4)==82&&r.getUint8(y+5)==61&&(M=!0,b=new Float32Array(v*3*3),_=r.getUint8(y+6)/255,w=r.getUint8(y+7)/255,u=r.getUint8(y+8)/255,x=r.getUint8(y+9)/255);const h=84,S=12*4+2,C=new wt,p=new Float32Array(v*3*3),L=new Float32Array(v*3*3);for(let y=0;y<v;y++){const Q=h+y*S,j=r.getFloat32(Q,!0),K=r.getFloat32(Q+4,!0),O=r.getFloat32(Q+8,!0);if(M){const z=r.getUint16(Q+48,!0);z&32768?(E=_,c=w,I=u):(E=(z&31)/31,c=(z>>5&31)/31,I=(z>>10&31)/31)}for(let z=1;z<=3;z++){const W=Q+z*12,T=y*3*3+(z-1)*3;p[T]=r.getFloat32(W,!0),p[T+1]=r.getFloat32(W+4,!0),p[T+2]=r.getFloat32(W+8,!0),L[T]=j,L[T+1]=K,L[T+2]=O,M&&(b[T]=E,b[T+1]=c,b[T+2]=I)}}return C.setAttribute("position",new xt(p,3)),C.setAttribute("normal",new xt(L,3)),M&&(C.setAttribute("color",new xt(b,3)),C.hasColors=!0,C.alpha=x),C}function l(m){const r=new wt,v=/solid([\s\S]*?)endsolid/g,E=/facet([\s\S]*?)endfacet/g;let c=0;const I=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,M=new RegExp("vertex"+I+I+I,"g"),b=new RegExp("normal"+I+I+I,"g"),_=[],w=[],u=new d;let x,h=0,S=0,C=0;for(;(x=v.exec(m))!==null;){S=C;const p=x[0];for(;(x=E.exec(p))!==null;){let Q=0,j=0;const K=x[0];for(;(x=b.exec(K))!==null;)u.x=parseFloat(x[1]),u.y=parseFloat(x[2]),u.z=parseFloat(x[3]),j++;for(;(x=M.exec(K))!==null;)_.push(parseFloat(x[1]),parseFloat(x[2]),parseFloat(x[3])),w.push(u.x,u.y,u.z),Q++,C++;j!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+c),Q!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+c),c++}const L=S,y=C-S;r.addGroup(L,y,h),h++}return r.setAttribute("position",new yt(_,3)),r.setAttribute("normal",new yt(w,3)),r}function e(m){return typeof m!="string"?$t.decodeText(new Uint8Array(m)):m}function f(m){if(typeof m=="string"){const r=new Uint8Array(m.length);for(let v=0;v<m.length;v++)r[v]=m.charCodeAt(v)&255;return r.buffer||r}else return m}const A=f(o);return s(A)?n(A):l(e(o))}}const H=new Jt,J=new Kt(75,window.innerWidth/window.innerHeight,.1,1e3);J.position.set(10,5,10);const q=new te({antialias:!0,alpha:!0});q.setSize(window.innerWidth,window.innerHeight);document.body.appendChild(q.domElement);const ve=new ee(4210752);H.add(ve);const Ot=new ne(16777215,.5);Ot.position.set(1,1,1);H.add(Ot);const be=new oe(5);H.add(be);const jt=new ie(J,q.domElement);function kt(){requestAnimationFrame(kt),jt.update(),q.render(H,J)}window.addEventListener("resize",function(){const a=window.innerWidth,o=window.innerHeight;q.setSize(a,o),J.aspect=a/o,J.updateProjectionMatrix()});let D;q.setClearColor(74565);q.setPixelRatio(window.devicePixelRatio);q.setSize(window.innerWidth,window.innerHeight);function Pe(a){const s=a.getPoints(1e3),t=new ae(s),n=new re(t,1e3,.01,8,!1),l=new Dt({wireframe:!0});return new i(n,l)}function ut(a,o,s,t){const n=new Rt(.1,32,16),l=new Pt({color:a}),e=new i(n,l);return e.position.set(o,s,t),H.add(e),e}const R={};function Ee(a){R.start&&H.remove(R.start),R.c1&&H.remove(R.c1),R.c2&&H.remove(R.c2),R.end&&H.remove(R.end),R.start=ut(16776960,a.start.x,a.start.y,a.start.z),R.c1=ut(16711680,a.c1.x,a.c1.y,a.c1.z),R.c2=ut(16711935,a.c2.x,a.c2.y,a.c2.z),R.end=ut(16777215,a.end.x,a.end.y,a.end.z),a.transformEnabled?(D.attach(R[a.transformTarget]),H.add(D)):D&&H.remove(D)}kt();let ft,Lt,Ht,Ft,Qt,Xt,V,vt;(async function(){const a=new Dt({wireframe:!0}),o=function(h){return new Promise((S,C)=>{const p=new FileReader;p.onload=function(L){const y=L.target.result,j=new Se().parse(y);S(j)},p.onerror=function(L){C(L)},p.readAsBinaryString(h)})},s=function(h){return new Promise((S,C)=>{const p=new FileReader;p.onload=function(L){const y=new he,Q=new de;Q.setDecoderPath("vendor/draco/gltf/"),y.setDRACOLoader(Q),y.parse(p.result,"",j=>S(j.scene.children[2].geometry))},p.onerror=function(L){C(L)},p.readAsArrayBuffer(h)})},t={start:{x:0,y:5,z:0},end:{x:5,y:0,z:5},c1:{x:5*.55,y:5,z:0},c2:{x:5,y:5*.45,z:0},p1:{x:0,y:0,z:0},p2:{x:0,y:0,z:0},stl:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},loaded:!1},currentControl:"control points",step:.01,curveSurface:{surface:"x-y",level:0,swing:0},transformTarget:"c1",transformEnabled:!1};c(),M();const n=new dat.GUI,l=n.addFolder("Translate STL");l.open(),l.add(t.stl.position,"x",-10,10,t.step).onChange(c),l.add(t.stl.position,"y",-10,10,t.step).onChange(c),l.add(t.stl.position,"z",-10,10,t.step).onChange(c);const e=n.addFolder("Rotate STL");e.open(),e.add(t.stl.rotation,"x",-2*Math.PI,2*Math.PI,t.step).onChange(c),e.add(t.stl.rotation,"y",-2*Math.PI,2*Math.PI,t.step).onChange(c),e.add(t.stl.rotation,"z",-2*Math.PI,2*Math.PI,t.step).onChange(c);const f=n.addFolder("Start Point");f.add(t.start,"x",-20,20,t.step).onChange(c).listen(),f.add(t.start,"y",-20,20,t.step).onChange(c).listen(),f.add(t.start,"z",-20,20,t.step).onChange(c).listen();const A=n.addFolder("Control Point 1");A.add(t.c1,"x",-20,20,t.step).onChange(c).listen(),A.add(t.c1,"y",-20,20,t.step).onChange(c).listen(),A.add(t.c1,"z",-20,20,t.step).onChange(c).listen();const m=n.addFolder("Control Point 2");m.add(t.c2,"x",-20,20,t.step).onChange(c).listen(),m.add(t.c2,"y",-20,20,t.step).onChange(c).listen(),m.add(t.c2,"z",-20,20,t.step).onChange(c).listen();const r=n.addFolder("End Point");r.add(t.end,"x",-20,20,t.step).onChange(c).listen(),r.add(t.end,"y",-20,20,t.step).onChange(c).listen(),r.add(t.end,"z",-20,20,t.step).onChange(c).listen();const v=n.addFolder("Moving with arrows");v.add(t,"transformEnabled").onChange(M).listen(),v.add(t,"transformTarget",["c1","c2"]).onChange(c);const E=n.addFolder("Curve surface");E.open(),E.add(t.curveSurface,"surface",["x-y","x-z","y-z"]),E.add(t.curveSurface,"level",-20,20,t.step).onChange(I),E.add(t.curveSurface,"swing",-5,5,t.step).onChange(I);function c(){V&&(V.position.set(t.stl.position.x,t.stl.position.y,t.stl.position.z),V.rotation.set(t.stl.rotation.x,t.stl.rotation.y,t.stl.rotation.z)),Ht=new d(t.start.x,t.start.y,t.start.z),Ft=new d(t.c1.x,t.c1.y,t.c1.z),Qt=new d(t.c2.x,t.c2.y,t.c2.z),Xt=new d(t.end.x,t.end.y,t.end.z),H.remove(ft),Lt=new se(Ht,Ft,Qt,Xt),ft=Pe(Lt),Ee(t),H.add(ft)}function I(){let h=[];t.curveSurface.surface==="x-y"?(h=[[t.start.x,t.start.y],[t.p1.x,t.p1.y],[t.p2.x,t.p2.y],[t.end.x,t.end.y]],t.start.z=t.curveSurface.level,t.end.z=t.curveSurface.level,t.c1.z=t.curveSurface.level,t.c2.z=t.curveSurface.level):t.curveSurface.surface==="x-z"?(h=[[t.start.x,t.start.z],[t.p1.x,t.p1.z],[t.p2.x,t.p2.z],[t.end.x,t.end.z]],t.start.y=t.curveSurface.level,t.end.y=t.curveSurface.level,t.c1.y=t.curveSurface.level,t.c2.y=t.curveSurface.level):t.curveSurface.surface==="y-z"&&(h=[[t.start.y,t.start.z],[t.p1.y,t.p1.z],[t.p2.y,t.p2.z],[t.end.y,t.end.z]],t.start.x=t.curveSurface.level,t.end.x=t.curveSurface.level,t.c1.x=t.curveSurface.level,t.c2.x=t.curveSurface.level);const p=ce(h,10)[0];t.curveSurface.surface==="x-y"?(t.c1.x=p[1][0],t.c1.y=p[1][1],t.c2.x=p[2][0],t.c2.y=p[2][1]):t.curveSurface.surface==="x-z"?(t.c1.x=p[1][0],t.c1.z=p[1][1],t.c2.x=p[2][0],t.c2.z=p[2][1]):t.curveSurface.surface==="y-z"&&(t.c1.y=p[1][0],t.c1.y=p[1][1],t.c2.y=p[2][0],t.c2.y=p[2][1]),t.curveSurface.surface==="x-y"?(t.c1.x+=t.curveSurface.swing,t.c1.y+=t.curveSurface.swing,t.c2.x+=t.curveSurface.swing,t.c2.y+=t.curveSurface.swing):t.curveSurface.surface==="x-z"?(t.c1.x+=t.curveSurface.swing,t.c1.z+=t.curveSurface.swing,t.c2.x+=t.curveSurface.swing,t.c2.z+=t.curveSurface.swing):t.curveSurface.surface==="y-z"&&(t.c1.y+=t.curveSurface.swing,t.c1.z+=t.curveSurface.swing,t.c2.y+=t.curveSurface.swing,t.c2.z+=t.curveSurface.swing),c()}function M(){t.transformEnabled?(D=new pe(J,q.domElement),D.addEventListener("objectChange",()=>{t[t.transformTarget].x=D.object.position.x,t[t.transformTarget].y=D.object.position.y,t[t.transformTarget].z=D.object.position.z}),D.addEventListener("dragging-changed",function(h){jt.enabled=!h.value,h.value===!1&&c()})):D&&D.dispose(),c()}const b=document.createElement("button");b.style.position="absolute",b.style.top=0,b.style.left=0,b.innerHTML="UPLOAD MODEL",b.addEventListener("click",async()=>{document.getElementById("fileInput").click()}),document.body.append(b);const _=document.createElement("button");_.style.position="absolute",_.style.bottom=0,_.style.left=0,_.innerHTML="PRINT CURVE",_.addEventListener("click",()=>{console.log(JSON.stringify({startPoint:{x:t.start.x,y:t.start.y,z:t.start.z},controlPoint1:{x:t.c1.x,y:t.c1.y,z:t.c1.z},controlPoint2:{x:t.c2.x,y:t.c2.y,z:t.c2.z},endPoint:{x:t.end.x,y:t.end.y,z:t.end.z}},null,4))}),document.body.append(_);const w=document.createElement("button");w.style.position="absolute",w.style.bottom="25px",w.style.left=0,w.innerHTML="NEW CURVE",w.addEventListener("click",()=>{const h=ft.clone();H.add(h),c()}),document.body.append(w),document.getElementById("fileInput").addEventListener("change",async function(h){const S=h.target.files[0];S&&(V&&H.remove(V),h.target.files[0].name.includes("stl")?vt=await o(S):vt=await s(S),V=new i(vt,a),H.add(V),t.stl.loaded=!0)});const u=document.createElement("div");u.style.position="absolute",u.style.bottom="0",u.style.right="0",u.style.display="flex",u.style.flexDirection="column",u.style.color="white",u.innerHTML="POSITION THE CAMERA BEFORE SETTING THE POINTS",document.body.append(u);function x(h){const S=document.createElement("button");S.innerHTML=`SET ${h} POINT`,S.addEventListener("click",()=>{if(!t.stl.loaded)return S.innerHTML="UPLOAD AN STL FILE FIRST",setTimeout(()=>{S.innerHTML=`SET ${h} POINT`},1e3),!1;S.innerHTML="CLICK ON THE STL",document.body.onclick=null,document.body.onclick=C=>{const p=new le,L=new Yt;L.firstHitOnly=!0,p.x=C.clientX/window.innerWidth*2-1,p.y=-(C.clientY/window.innerHeight)*2+1,L.setFromCamera(p,J);const y=L.intersectObjects(H.children,!0);y.length>0?(t[h].x=y[0].point.x,t[h].y=y[0].point.y,t[h].z=y[0].point.z,S.innerHTML=`SET ${h} POINT`,document.body.onclick=null,I()):S.innerHTML="TARGET THE STL"}}),u.append(S)}x("start"),x("p1"),x("p2"),x("end")})();
